<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="mainTitle">ë¸”ë¡ì½”ë”© ì›¹ì—ë””í„° for ì•„ë‘ì´ë…¸</title>
    <link rel="icon" href="favicon.ico">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PX4LFJ1M1Z"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-PX4LFJ1M1Z');
    </script>
    	
    <script type="text/javascript" src="//wcs.pstatic.net/wcslog.js"></script>
    <script type="text/javascript">
    if(!wcs_add) var wcs_add = {};
    wcs_add["wa"] = "132d13e13a2a880";
    if(window.wcs) {
    wcs_do();
    }
    </script>
    
    <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/12.2.0/blockly_compressed.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/12.2.0/blocks_compressed.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/12.2.0/javascript_compressed.js"></script>
    
    <!-- Monaco Editor -->
    <link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs/editor/editor.main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs/loader.min.js"></script>
    
    <!-- ê¸°ì¡´ ë¸”ë¡ì½”ë”© ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="translations/i18n.js"></script>
    <script src="brixel/brixel_core.js"></script>
    <script src="brixel/brixel_blocks_definitions.js"></script>
    <script src="brixel/brixel_blocks_code_generators.js"></script>
    <script src="brixel/brixel_utils.js"></script>
    <script src="brixel/brixel_toolbox.js"></script>
    
    <!-- ë¶„ë¦¬ëœ CSS (RTL ëŒ€ì‘ í¬í•¨) -->
    <link rel="stylesheet" href="ide-styles.css">
    
    <style>
        /* PC ì—ì´ì „íŠ¸ ì—°ê²° íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .agent-connection-panel {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .connection-status {
            font-size: 16px;
            font-weight: 600;
        }
        
        .connection-status.connected {
            color: #28a745;
        }
        
        .connection-status.disconnected {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div id="loadingText" data-i18n="loadingText">ì •ì  ì›¹ IDE ì´ˆê¸°í™” ì¤‘...</div>
        </div>
    </div>
    
    <div class="ide-container">
        <!-- ìƒë‹¨ íˆ´ë°” -->
        <div class="toolbar">
            <div class="toolbar-left">
                <h1 data-i18n="mainTitle">Brixel ì›¹ì—ë””í„° for Arduino 
                    <span class="board-indicator" id="boardIndicator">UNO</span>
                </h1>
                <div class="mode-toggle">
                    <button class="mode-btn active" id="blockModeBtn" data-mode="block" data-i18n="blockModeBtn">ë¸”ë¡ì½”ë”©</button>
                    <button class="mode-btn" id="textModeBtn" data-mode="text" data-i18n="textModeBtn">í…ìŠ¤íŠ¸ì½”ë”©</button>
                </div>
            </div>
            <div class="toolbar-buttons">
                <button class="btn btn-compile" id="compileBtn" disabled data-i18n="compileBtn">âš™ï¸ ì½”ë“œ ì»´íŒŒì¼</button>
                <button class="btn btn-upload" id="uploadBtn" disabled data-i18n="uploadBtn">ğŸ“¤ ë³´ë“œì— ì—…ë¡œë“œ</button>
            </div>
        </div>
        
        <!-- ë©”ì¸ ì—ë””í„° ì˜ì—­ -->
        <div class="editor-area" id="editorArea">
            <!-- ë¸”ë¡ì½”ë”© íŒ¨ë„ -->
            <div class="blockly-panel" id="blocklyPanel">
                <div class="blockly-header" data-i18n="blocklyHeaderTitle">
                    ğŸ§© ë¸Œë¦­ì…€ ë¸”ë¡ ì½”ë”© ì—ë””í„°
                </div>
                <div id="blocklyDiv"></div>
            </div>
            
            <!-- ì½”ë“œ í‘œì‹œ/í¸ì§‘ íŒ¨ë„ -->
            <div class="code-panel">
                <div class="code-header">
                    <span id="codeTitle" data-i18n="codeTitle">ğŸ“„ ì‹¤ì‹œê°„ Arduino C++ ì½”ë“œ</span>
                    <button class="copy-btn" id="copyBtn" data-i18n="copyBtn">ğŸ“‹ ë³µì‚¬</button>
                </div>
                <div class="code-content">
                    <!-- ë¸”ë¡ì½”ë”© ëª¨ë“œ: ìƒì„±ëœ ì½”ë“œ í‘œì‹œ -->
                    <pre id="codePreview" data-i18n="codePreview_initial">// ë¸”ë¡ì„ ë°°ì¹˜í•˜ë©´ ì—¬ê¸°ì— ì½”ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤.</pre>
                    
                    <!-- í…ìŠ¤íŠ¸ ëª¨ë“œ: ëª¨ë‚˜ì½” ì—ë””í„° (RTL ëŒ€ì‘ ì™„ë£Œ) -->
                    <div id="monacoEditor" class="hidden"></div>
                </div>
            </div>
        </div>
        
        <!-- ìš°ì¸¡ ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
        <div class="control-panel">
            <!-- íŒŒì¼ ê´€ë¦¬ -->
            <div class="panel-section">
                <h3 data-i18n="sectionTitleLanguage">ğŸŒ ì–¸ì–´ ë° íŒŒì¼ ê´€ë¦¬</h3>
                <div class="form-row">
                    <label data-i18n="labelLanguage">ì–¸ì–´:</label>
                    <select id="languageSelect">
                    </select>
                </div>
                <div class="form-row">
                    <label data-i18n="labelFilename">íŒŒì¼ëª…:</label>
                    <input type="text" id="fileNameInput" data-i18n-placeholder="fileNameInput_placeholder" placeholder="arduino_project">
                </div>
                <div class="form-row">
                    <button id="saveBtn" class="success" data-i18n="saveBtn">ğŸ’¾ ì €ì¥</button>
                    <button id="loadBtn" data-i18n="loadBtn">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                    <input type="file" id="loadFile" style="display: none;" accept=".xml,.ino">
                </div>
            </div>

            <!-- ë³´ë“œ ì„ íƒ -->
            <div class="panel-section">
                <h3 data-i18n="sectionTitleBoard">ğŸ¯ ë³´ë“œ ì„ íƒ</h3>
                <div class="form-row">
                    <select id="boardSelect">
                        <optgroup data-i18n="boardGroupArduino_label" label="ğŸ”µ Arduino ê³„ì—´">
                            <option value="uno" data-i18n="boardUno">Arduino Uno</option>
                            <option value="nano" data-i18n="boardNano">Arduino Nano</option>
                            <option value="mega" data-i18n="boardMega">Arduino Mega</option>
                        </optgroup>
                        <optgroup data-i18n="boardGroupEsp32_label" label="ğŸŸ  ESP32 ê³„ì—´">
                            <option value="esp32" data-i18n="boardEsp32">ESP32 Dev Module</option>
                            <option value="esp32s2" data-i18n="boardEsp32s2">ESP32-S2</option>
                            <option value="esp32c3" data-i18n="boardEsp32c3">ESP32-C3</option>
                            <option value="esp32s3" data-i18n="boardEsp32s3">ESP32-S3</option>
                        </optgroup>
                        <optgroup data-i18n="boardGroupPico_label" label="ğŸŸ£ Raspberry Pi Pico">
                            <option value="pico" data-i18n="boardPico">Raspberry Pi Pico</option>
                            <option value="picow" data-i18n="boardPicow">Raspberry Pi Pico W</option>
                        </optgroup>
                    </select>
                </div>
            </div>
            
            <!-- ì—…ë¡œë“œ í¬íŠ¸ -->
            <div class="panel-section">
                <h3 data-i18n="sectionTitlePort">ğŸ”Œ ì—…ë¡œë“œ í¬íŠ¸</h3>
                <div class="port-selector">
                    <select id="portSelect" disabled>
                        <option value="" data-i18n="portAutoSelect">í¬íŠ¸ë¥¼ ìƒˆë¡œê³ ì¹¨ í•˜ì„¸ìš”.</option>
                    </select>
                    <button id="refreshPortsBtn" class="icon-btn" data-i18n="refreshPortsBtn_title" title="í¬íŠ¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨" disabled>ğŸ”„</button>
                </div>
                <div style="font-size: 11px; color: #6c757d; margin-top: 5px;" data-i18n="portDisabledMessage">
                    * PC ì—ì´ì „íŠ¸ ì—°ê²° í›„ ì‚¬ìš© ê°€ëŠ¥
                </div>
            </div>
            
            <!-- ë‹¨ìˆœí™”ëœ PC ì—ì´ì „íŠ¸ ì—°ê²° ìƒíƒœ -->
            <div class="panel-section">
                <h3 data-i18n="sectionTitleConnection">ğŸ”— PC ì—ì´ì „íŠ¸ ì—°ê²°</h3>
                <div class="agent-connection-panel">
                    <div class="connection-status disconnected" id="connectionStatus" data-i18n="connectionStatusDisconnected">
                        âŒ PC ì—ì´ì „íŠ¸ì™€ ì—°ê²°ë˜ì§€ ì•ŠìŒ
                    </div>
                </div>
            </div>
                        <!-- ì—ì´ì „íŠ¸ ë‹¤ìš´ë¡œë“œ -->
            <div class="panel-section">
                <h3 data-i18n="sectionTitleDownload">â¬‡ï¸ ì—ì´ì „íŠ¸ ë‹¤ìš´ë¡œë“œ</h3>
                <div class="download-selector">
                    <select id="agentOsSelect">
                        <option value="win" data-i18n="agentOsWin">Windows ìš©</option>
                        <option value="mac" data-i18n="agentOsMac">macOS ìš©</option>
                        <option value="linux" data-i18n="agentOsLinux">Linux ìš©</option>
                    </select>
                    <button id="downloadAgentBtn" class="icon-btn" data-i18n="downloadAgentBtn_title" title="ì—ì´ì „íŠ¸ ë‹¤ìš´ë¡œë“œ">ğŸ’¾</button>
                </div>
            </div>
                        <!-- ì‹¤ì‹œê°„ ë¡œê·¸ ì½˜ì†” -->
            <div class="panel-section">
                <h3 data-i18n="consoleHeader">ğŸ“º ì‹¤ì‹œê°„ ë¡œê·¸</h3>
                <div class="console-panel">
                    <div class="console-output" id="consoleOutput"></div>
                </div>
            </div>
        </div>
        
   </div>

    <!-- Blockly íˆ´ë°•ìŠ¤ -->
    <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none"></xml>

    <script>
        // PC ì—ì´ì „íŠ¸ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ë‹¨ìˆœí™”ë¨)
        function updateAgentStatus(isConnected) {
            const connectionStatus = document.getElementById('connectionStatus');
            const portSelect = document.getElementById('portSelect');
            const refreshPortsBtn = document.getElementById('refreshPortsBtn');
            const compileBtn = document.getElementById('compileBtn');
            const uploadBtn = document.getElementById('uploadBtn');
            
            // ì—°ê²° ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
            if (connectionStatus) {
                if (isConnected) {
                    // ë²ˆì—­ ì‹œìŠ¤í…œ ì‚¬ìš©
                    const connectedText = window.IDEI18n ? 
                        window.IDEI18n.getMsg('connectionStatusConnected', 'âœ… PC ì—ì´ì „íŠ¸ì™€ ì—°ê²°ë¨') : 
                        'âœ… PC ì—ì´ì „íŠ¸ì™€ ì—°ê²°ë¨';
                    connectionStatus.textContent = connectedText;
                    connectionStatus.className = 'connection-status connected';
                    connectionStatus.setAttribute('data-i18n', 'connectionStatusConnected');
                } else {
                    // ë²ˆì—­ ì‹œìŠ¤í…œ ì‚¬ìš©
                    const disconnectedText = window.IDEI18n ? 
                        window.IDEI18n.getMsg('connectionStatusDisconnected', 'âŒ PC ì—ì´ì „íŠ¸ì™€ ì—°ê²°ë˜ì§€ ì•ŠìŒ') : 
                        'âŒ PC ì—ì´ì „íŠ¸ì™€ ì—°ê²°ë˜ì§€ ì•ŠìŒ';
                    connectionStatus.textContent = disconnectedText;
                    connectionStatus.className = 'connection-status disconnected';
                    connectionStatus.setAttribute('data-i18n', 'connectionStatusDisconnected');
                }
            }
            
            // ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
            if (portSelect) portSelect.disabled = !isConnected;
            if (refreshPortsBtn) refreshPortsBtn.disabled = !isConnected;
            if (compileBtn) compileBtn.disabled = !isConnected;
            if (uploadBtn) uploadBtn.disabled = !isConnected;
        }
        
        // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡
        window.updateAgentStatus = updateAgentStatus;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            updateAgentStatus(false);
        });
    </script>

    <script>
    // ì—ì´ì „íŠ¸ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥
    document.addEventListener('DOMContentLoaded', function() {
        // ë‹¤ìš´ë¡œë“œ íŒŒì¼ ì •ë³´
        const downloadFiles = {
            win: {
                url: 'https://www.gorillacell.kr/webide/download_agent_git/Arduino Local Agent 2.2 Setup 2.2.0.exe',
                filename: 'Arduino Local Agent 2.2 Setup 2.2.0.exe'
            },
            mac: {
                url: 'https://www.gorillacell.kr/webide/download_agent_git/Arduino Local Agent.dmg', 
                filename: 'Arduino Local Agent.dmg'
            },
            linux: {
                url: 'https://www.gorillacell.kr/webide/download_agent_git/Arduino Local Agent.tar.gz',
                filename: 'Arduino Local Agent.tar.gz'
            }
        };

        const osSelect = document.getElementById('agentOsSelect');
        const downloadBtn = document.getElementById('downloadAgentBtn');

        function downloadFile(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.style.display = 'none';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        if (downloadBtn && osSelect) {
            downloadBtn.addEventListener('click', function() {
                const selectedOs = osSelect.value;
                const fileInfo = downloadFiles[selectedOs];
                
                if (fileInfo) {
                    downloadFile(fileInfo.url, fileInfo.filename);
                    
                    const originalText = downloadBtn.innerHTML;
                    downloadBtn.innerHTML = 'â¬‡ï¸ ë‹¤ìš´ë¡œë“œ ì¤‘...';
                    downloadBtn.disabled = true;
                    
                    setTimeout(() => {
                        downloadBtn.innerHTML = originalText;
                        downloadBtn.disabled = false;
                    }, 2000);
                }
            });
        }

        if (osSelect && downloadBtn) {
            osSelect.addEventListener('change', function() {
                const selectedOs = this.value;
                const osNames = {
                    win: 'Windows',
                    mac: 'macOS', 
                    linux: 'Linux'
                };
                downloadBtn.title = `${osNames[selectedOs]} ìš© ì—ì´ì „íŠ¸ ë‹¤ìš´ë¡œë“œ`;
            });
        }
    });
    </script>

    <!-- ëª¨ë“ˆí™”ëœ JavaScript íŒŒì¼ë“¤ (RTL ëŒ€ì‘ ì™„ë£Œ) -->
    <script src="js/ide-utils.js"></script>
    <script src="js/ide-i18n.js"></script>
    <script src="js/ide-editors.js"></script>
    <script src="js/ide-file-manager.js"></script>
    <script src="js/ide-server-comm.js"></script>
    <script src="js/ide-core.js"></script>
</body>
</html>